<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Chess by Z</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f1216" />

  <style>
    :root{
      --bg:#0f1216; --layer:#141922; --muted:#8aa0b6; --text:#e8eef5;
      --square-dark:#2a3443; --square-light:#3a475b; --hl:#6ba7ff;
      --accent:#6ba7ff; --good:#39d98a; --bad:#ff6b6b;
      --cell: 64px; --pieceSize: 52px;
      --content-w: 92vw;
    }
    *{box-sizing:border-box}
    html, body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font: 15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial;
    }
    a{color:var(--accent); text-decoration:none} a:hover{text-decoration:underline}
    .muted{color:var(--muted)}
    .page{max-width:1400px; margin:0 auto; padding:16px}

    header{display:flex; flex-direction:column; align-items:center; gap:6px; margin-bottom:12px}
    header h1{margin:4px 0 0 0; font-weight:800; letter-spacing:.2px; text-align:center}
    header .subtitle{font-size:13px; color:var(--muted); margin-bottom:4px; text-align:center}

    /* Board section first; controls below (single column) */
    .stack{display:flex; flex-direction:column; gap:14px}

    .board-wrap{
      position:relative; background:var(--layer);
      border:1px solid #222a36; border-radius:12px; padding:10px;
      margin-inline:auto; width:92vw; max-width:660px;
    }
    @media (min-width: 980px){
      .board-wrap{ width:50vw; max-width:none; }
    }

    /* Board */
    #board{ position:relative; 
      width:100%; aspect-ratio:1/1; display:grid;
      grid-template-columns:repeat(8, 1fr);
      grid-template-rows:repeat(8, 1fr);
      border-radius:12px; overflow:hidden; touch-action:none; cursor:grab; user-select:none;
    }
    .sq{position:relative; display:flex; align-items:center; justify-content:center; line-height:1; font-size:var(--pieceSize)}
    .sq.light{background:var(--square-light)} .sq.dark{background:var(--square-dark)}
    .sq.sel{outline:3px solid rgba(107,167,255,.95); outline-offset:-3px}
    .sq.hover{box-shadow: inset 0 0 0 3px rgba(107,167,255,.95)}
    .sq .dot{position:absolute; width:28%; height:28%; border-radius:50%; background:rgba(255,255,255,0.35)}
    .sq.cap::after{content:""; position:absolute; inset:10%; border:3px solid rgba(255,255,255,.55); border-radius:50%}
    .sq.dragSource{opacity:.25}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-3px)}50%{transform:translateX(3px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}
    .sq.shake{animation:shake .18s}

    /* Unicode chess pieces (black glyphs for both; recolored via CSS) */
    .piece{
      font-family:
        "Noto Sans Symbols2",
        "Segoe UI Symbol",
        "DejaVu Sans",
        "Symbola",
        "FreeSerif",
        serif;
      font-variant-emoji: text;
    }
    .sq.pw, .dragPiece.pw{color:#f2f5f8; text-shadow: 0 1px 0 rgba(0,0,0,.6), 0 0 4px rgba(0,0,0,.35)}
    .sq.pb, .dragPiece.pb{color:#101419; text-shadow: 0 1px 0 rgba(255,255,255,.08), 0 0 2px rgba(255,255,255,.05)}

    /* Drag ghost */
    .dragPiece{
      position:absolute; width:var(--cell); height:var(--cell);
      display:flex; align-items:center; justify-content:center;
      font-size:var(--pieceSize); pointer-events:none; filter: drop-shadow(0 6px 10px rgba(0,0,0,.45));
      transition:none
    }
    #board.dragging{cursor:grabbing}

    /* overlays */
    .overlay{position:absolute; inset:10px; pointer-events:none}
    svg.arrow{position:absolute; inset:0; pointer-events:none}
    .fxCanvas{position:absolute; inset:10px; pointer-events:none; display:none; z-index:25}

    .evalbar{position:absolute; left:0; top:10px; bottom:10px; width:10px; border-radius:8px; background:#222a36; overflow:hidden; display:none}
    .evalbar .white{background:#f2f5f8; width:100%; height:50%}
    .evalbar .black{background:#0c0f14; width:100%; height:50%}

    /* Promotion */
    .promo{position:absolute; inset:0; background:rgba(10,14,20,.5); display:none; align-items:center; justify-content:center; z-index:30}
    .promo .box{background:#0c1118; border:1px solid #1c2533; border-radius:12px; padding:10px; display:flex; gap:8px}
    .promo .opt{width:56px; height:56px; background:#141a25; border:1px solid #1c2533; border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:28px}

    /* Cards */
    .card{background:var(--layer); border:1px solid #222a36; border-radius:12px; padding:10px}
    .row{display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin:6px 0}
    .row label{min-width:80px}

    .pv{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:13px}
    .status{margin-top:6px; min-height:24px}
    .badge{display:inline-flex; min-width:10px; height:18px; padding:0 6px; align-items:center; justify-content:center; border-radius:999px; background:#112033; border:1px solid #27405c; font-size:12px; color:#cfe2ff}

    /* Game info button + popover (App.js injects the button; styles here) */
    .game-info-trigger{
      position:absolute; top:12px; right:12px;
      width:28px; height:28px;
      display:flex; align-items:center; justify-content:center;
      background:#0f141c; color:#cfe2ff;
      border:1px solid #27405c; border-radius:999px;
      font-weight:700; font-size:14px; line-height:1; cursor:pointer;
    }
    .game-info-trigger:hover{ background:#122032; }
    .game-info-pop{
      position:absolute; top:12px; right:12px; transform: translateY(36px);
      width:min(90vw, 360px);
      background:#0c1118; border:1px solid #1c2533; border-radius:12px; padding:10px;
      box-shadow: 0 10px 24px rgba(0,0,0,.45);
      z-index:40; display:none;
    }
    .game-info-pop.open{ display:block; }
    .tip-row{ display:flex; gap:8px; margin:6px 0; align-items:flex-start }
    .tip-label{ min-width:82px; color:var(--muted) }
    .tip-value{ flex:1 }
    .tip-moves{
      flex:1;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:13px; line-height:1.35;
      white-space:normal; word-wrap:break-word;
    }
  
    /* Arrow rendering polish */
    svg .user-arrows line,
    svg .sys-arrows line { stroke-linecap: round; }
    svg .user-arrows polygon,
    svg .sys-arrows polygon { shape-rendering: geometricPrecision; }
    </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Chess by Z</h1>
      <div class="subtitle">Fully offline • No dependencies • Client-side engine</div>
    </header>

    <div class="stack">
      <!-- BOARD FIRST -->
      <div class="board-wrap">
        <div class="evalbar" id="evalbar">
          <div class="white" id="evalWhite"></div>
          <div class="black" id="evalBlack"></div>
        </div>

        <div id="board">
          <!-- 64 squares created by JS -->
          <svg class="arrow" id="arrowSvg" viewBox="0 0 800 800" preserveAspectRatio="none"></svg>
        </div>
        <canvas id="fireworks" class="fxCanvas" aria-hidden="true"></canvas>

        <!-- Promotion dialog -->
        <div class="promo" id="promo">
          <div class="box">
            <div class="opt" data-piece="q">♛</div>
            <div class="opt" data-piece="r">♜</div>
            <div class="opt" data-piece="b">♝</div>
            <div class="opt" data-piece="n">♞</div>
          </div>
        </div>
      </div>

      <!-- CONTROLS UNDER THE BOARD -->
      <div class="card">
        <div class="row">
          <label for="mode">Mode</label>
          <select id="mode">
            <option value="play">Play vs Engine</option>
            <option value="analysis">Analysis</option>
            <option value="puzzle">Puzzles</option>
          </select>

          <label for="side">Your side</label>
          <select id="side">
            <option value="white">White</option>
            <option value="black">Black</option>
          </select>

          <button id="flip">Flip</button>
          <button id="newGame">New Game</button>
          <span class="badge" id="sabBadge" title="SharedArrayBuffer status"></span>
        </div>

        <div class="row" id="knobsRow">
          <label class="muted">Elo</label>
          <input type="range" id="elo" min="800" max="3000" step="50" value="3000" />
          <span id="eloVal">3000</span>

          <label class="muted">Depth</label>
          <input type="range" id="depth" min="2" max="22" step="1" value="22" />
          <span id="depthVal">22</span>

          <label class="muted">MultiPV</label>
          <input type="range" id="multipv" min="1" max="4" step="1" value="1" />
          <span id="multipvVal">1</span>

          <label class="muted">Think (ms)</label>
          <input type="range" id="think" min="50" max="3000" step="50" value="3000" />
          <span id="thinkVal">3000</span>
        </div>

        <div class="row">
          <label class="muted">Opening book (offline)</label>
          <input type="checkbox" id="useBook" checked />
          <span class="muted">• Play mode only, first ~10 plies</span>
        </div>

        <div class="row">
          <button class="button" id="analyzeBtn">Analyze</button>
          <button class="button" id="hintBtn">Hint</button>
          <button class="button" id="stopBtn">Stop</button>
          <span class="muted" id="autoSummary"></span>
        </div>

        <div class="row">
          <div class="pv" id="pvBox"></div>
        </div>
        <div class="row">
          <div id="engineStatus" class="muted">Engine: ready</div>
        </div>

        <hr />

        <!-- Clock settings + clocks together -->
        <div class="row">
          <label>Clock</label>
          <input type="number" id="timeMin" value="5" min="1" max="180" />
          <span class="muted">min</span>
          <input type="number" id="incSec" value="3" min="0" max="60" />
          <span class="muted">+ sec</span>
          <button id="startClocks">Start</button>
          <button id="pauseClocks">Pause</button>
          <button id="resetClocks">Reset</button>
          <div style="flex:1"></div>
          <div class="badge" id="clockWhite">05:00</div>
          <div class="badge" id="clockBlack">05:00</div>
        </div>
      </div>

      <!-- Optional: Game/PGN helpers -->
      <div class="card">
        <h3>Game / PGN</h3>
        <div class="row">
          <button id="copyPgn">Copy PGN</button>
          <button id="loadPgn">Load PGN</button>
          <input id="pgnText" placeholder="Paste PGN here" style="flex:1" />
        </div>
        <div class="row">
          <button id="exportFen">Copy FEN</button>
          <button id="importFen">Load FEN</button>
          <input id="fenText" placeholder="Paste FEN here" style="flex:1" />
        </div>
      </div>

      <!-- Puzzles -->
      <div class="card" id="puzzlePanel" style="display:none">
        <h3>Puzzles</h3>
        <div class="row">
          <button id="fetchDaily">Daily</button>
          <button id="randomFromPack">Random</button>
          <button id="nextPuzzle">Next</button>
          <button id="puzzleHint">Hint</button>
        </div>
        <div class="row">
          <label>Load by ID:</label>
          <input id="puzzleIdInput" placeholder="lichess id" />
          <button id="loadById">Load</button>
        </div>
        <div class="row">
          <button id="importCsvBtn">Import CSV</button>
          <input type="file" id="importCsvFile" accept=".csv" />
        </div>
        <div class="row">
          <label>Pack URL:</label>
          <input id="packUrl" placeholder="https://..." style="flex:1" />
          <button id="downloadPackBtn">Download</button>
          <button id="demoPackBtn">Load sample</button>
          <button id="sample500Btn">Sample 500</button>
        </div>
        <div class="row">
          <label>Theme</label>
          <input id="themeFilter" placeholder="mate, fork, pin..." style="flex:1" />
          <label>Rating</label>
          <input id="minRating" placeholder="min" type="number" style="width:90px" />
          <input id="maxRating" placeholder="max" type="number" style="width:90px" />
        </div>
        <div class="muted" id="packInfo">—</div>
        <div class="muted" id="puzzleInfo">—</div>
        <div class="status" id="puzzleStatus"></div>
      </div>
    </div>
  </div>

  <!-- App entry + engine boot (leave these as-is for your current project) -->
  <script type="module" src="./src/app/App.js"></script>
  <script type="module" src="./src/engine/boot.js"></script>
</body>
</html>
